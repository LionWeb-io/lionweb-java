syntax = "proto3";

package io.lionweb.protobuf;

option java_multiple_files = true;
option java_package = "io.lionweb.protobuf";
option java_outer_classname = "BulkImportProtos";

import "io/lionweb/protobuf/Chunk.proto";

// We make use of interned strings, languages, and meta-pointers because this is leading to significant performance
// benefits.
// So many integer values are indexes into tables of interned values.
// Values prefixed with "si_" are string indexes
// Values prefixed with "mpi_" are meta-pointer indexes
//
// Null values for strings and languages are encoded as 0, so indexes into these tables
// are shifted by one. Specifically:
// - During serialization: null → 0; value i → index (i + 1), where i is the position in the interned table.
// - During deserialization: 0 → null; index i → element (i - 1) of the interned table.

message PBBulkImport {
  // We use this mechanism both to save space and to represent nulls (identified by -1)
  repeated string interned_strings = 1;
  repeated PBMetaPointer interned_meta_pointers= 2;
  repeated PBLanguage interned_languages = 5;
  repeated PBAttachPoint attach_points = 3;
  repeated PBNode nodes = 4;
}

message PBAttachPoint {
  uint32 si_container = 1;
  uint32 mpi_meta_pointer = 2;
  uint32 si_root = 3;
}

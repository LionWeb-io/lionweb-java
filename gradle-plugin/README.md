# LionWeb Gradle Plugin

This module publishes the Gradle plugin `io.lionweb`, which generates Java sources from LionWeb
language definitions and packages language JSON files into your JAR.

## Apply the plugin

Kotlin DSL:

```kotlin
plugins {
  id("io.lionweb") version "VERSION"
}
```

Groovy DSL:

```groovy
plugins {
  id "io.lionweb" version "VERSION"
}
```

## Configure

The plugin exposes a `lionweb` extension. Defaults are provided for the input/output directories.

```kotlin
lionweb {
  defaultPackageName.set("com.example.languages")
  languagesDirectory.set(layout.projectDirectory.dir("src/main/lionweb"))
  generationDirectory.set(layout.buildDirectory.dir("generated/lionweb"))
  languagesSpecificPackages.put("com.example.mylanguage", "com.example.mylanguage")
  languagesClassNames.put("com.example.mylanguage", "MyLanguage")
  languagesToGenerate.set(setOf("MyLanguage", "com.example.mylanguage"))
  primitiveTypes.put("com.example.types.Instant", "java.time.Instant")
  mappings.put("com.example.other.ExternalConcept", "com.example.other.ExternalConceptImpl")
}
```

Key settings:

- `defaultPackageName`: Base package for generated code. Required unless every language has a
  `languagesSpecificPackages` entry.
- `languagesDirectory`: Folder containing LionWeb language JSON files. Defaults to
  `src/main/lionweb`.
- `generationDirectory`: Target folder for generated Java sources. Defaults to
  `build/generated-lionweb`.
- `primitiveTypes`: Map from LionWeb primitive type IDs to Java fully qualified type names.
- `languagesSpecificPackages`: Map from LionWeb language IDs to package names.
- `languagesClassNames`: Map from LionWeb language IDs to generated `Language` class names.
- `languagesToGenerate`: Restricts generation to specific language names, IDs, or keys.
- `mappings`: Map from classifier qualified names to Java fully qualified type names, used when a
  referenced classifier is not generated by this plugin.

## Tasks

- `generateLWLanguages`: Generates Java `Language` classes from serialized language definitions.
- `generateLWNodeClasses`: Generates Java node classes (concepts, interfaces, enumerations).

Both tasks:

- Read project language files from `languagesDirectory` (recursively).
- Load dependency language files from `META-INF/lionweb/*.json` on the `compileClasspath`.
- Write generated sources to `generationDirectory`.

If you want the generated sources compiled, add the output directory to your source set, for
example:

```kotlin
sourceSets.named("main") {
  java.srcDir(lionweb.generationDirectory)
}
```

## Limitations

- Protobuf (`.pb`) language files are discovered but not yet supported.
- Node class generation does not yet support extended concepts or structured data types.

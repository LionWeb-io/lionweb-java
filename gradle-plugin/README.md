# LionWeb Gradle Plugin

This module publishes the Gradle plugin `io.lionweb`, which generates Java sources from LionWeb
language definitions and packages language JSON files into your JAR.

## Apply the plugin

Kotlin DSL:

```kotlin
plugins {
  id("io.lionweb") version "VERSION"
}
```

Groovy DSL:

```groovy
plugins {
  id "io.lionweb" version "VERSION"
}
```

## Configure

The plugin exposes a `lionweb` extension. Defaults are provided for the input/output directories.

```kotlin
lionweb {
     // Where to look for language definitions, defaults to src/main/lionweb
     languagesDirectory = layout.projectDirectory.dir("my-dir-full-of-languages")
  
     // Set the package names with a global default and specific settings
     defaultPackageName = "com.example.languages"
     languagesSpecificPackages = mapOf("com_example_mylanguage_id" to "com.example.mylanguage")
  
     // Defaults to build/generated-lionweb
     generationDirectory.set(layout.buildDirectory.dir("my-generation-dir"))
  
     // If we want to force the Language Class to have a specific name, we can
     languagesClassNames = mapOf("com.example.mylanguage" to "MyLanguage")
  
     // If we want to generate code only for some of the languages (as the others are just dependencies,
     // for example), we can use this setting
     languagesToGenerate = setOf("MyLanguage")
  
     // Classes for primitive types must be written manually and specified here
     primitiveTypes = mapOf("com.example.types.Instant" to "java.time.Instant")
  
     // Our language may refer to concepts for which a class has been already written. If so,
     // this setting let the generator know about it.
     mappings = mapOf("com.example.other.MyConcept" to "com.example.other.MyConceptImpl")
}
```

Key settings:

- `defaultPackageName`: Base package for generated code. Required unless every language has a
  `languagesSpecificPackages` entry.
- `languagesDirectory`: Folder containing LionWeb language JSON files. Defaults to
  `src/main/lionweb`.
- `generationDirectory`: Target folder for generated Java sources. Defaults to
  `build/generated-lionweb`.
- `primitiveTypes`: Map from LionWeb primitive type IDs to Java fully qualified type names.
- `languagesSpecificPackages`: Map from LionWeb language IDs to package names.
- `languagesClassNames`: Map from LionWeb language IDs to generated `Language` class names.
- `languagesToGenerate`: Restricts generation to specific language names, IDs, or keys.
- `mappings`: Map from classifier qualified names to Java fully qualified type names, used when a
  referenced classifier is not generated by this plugin.

## Tasks

- `generateLWLanguages`: Generates Java `Language` classes from serialized language definitions.
- `generateLWNodeClasses`: Generates Java node classes (concepts, interfaces, enumerations).

Both tasks:

- Read project language files from `languagesDirectory` (recursively).
- Load dependency language files from `META-INF/lionweb/*.json` on the `compileClasspath`.
- Write generated sources to `generationDirectory`.

If you want the generated sources compiled, add the output directory to your source set, for
example:

```kotlin
sourceSets.named("main") {
  java.srcDir(lionweb.generationDirectory)
}
```

## Limitations

- Protobuf (`.pb`) language files are discovered but not yet supported.
- Node class generation does not yet support extended concepts or structured data types.
